---

- name: download archive
  unarchive:
    src: "{{ drivers.megaraid_sas.url }}"
    dest: /tmp
    copy: no
    creates: "/tmp/megaraid_sas-{{ drivers.megaraid_sas.version }}-src.tar.gz"

- name: extract source in kernel tree
  unarchive:
    src: "/tmp/megaraid_sas-{{ drivers.megaraid_sas.version }}-src.tar.gz"
    dest: '/usr/src'
    creates: "/usr/src/megaraid_sas-{{ drivers.megaraid_sas.version }}"

- lineinfile:
    path: "/usr/src/megaraid_sas-{{ drivers.megaraid_sas.version }}/dkms.conf"
    regexp: '^PACKAGE_VERSION'
    line: "PACKAGE_VERSION={{ drivers.megaraid_sas.version }}"
